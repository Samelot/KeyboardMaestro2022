#!/bin/bash
# Rob Trew twitter: @ComplexPoint 2015
osascript -l JavaScript <<JXA_END 2>/dev/null
(function(c,h,k,f){c=c||"Finder";f=f||"leave it at the front";var e=function(b){var d=Application.currentApplication(),d=(d.includeStandardAdditions=!0,d),a;try{a=d.doShellScript(["osascript <<AS_END 2>/dev/null",'set strID to id of application "'+b+'"','tell application "Finder"\n\tset strPath to POSIX path of (application file id strID as alias)\nend tell\nstrID & linefeed & strPath\nAS_END'].join("\n")).split(/[\r\n]+/)}catch(c){a=[]}return 1<a.length?{id:a[0],path:a[1]}:null},g=(e=function(b){b=
	Application("System Events").applicationProcesses.where({name:b});return(b=b.length?b[0]:null)?{id:b.bundleIdentifier(),path:b.file.posixPath().toString()}:null}(c)||e(c))?e.id:null;return function(b){var d={array:function(a){return a.length?"<array>"+a.reduce(function(a,b){return a+d[typeof b](b)},"")+"</array>":"<array/>"},"boolean":function(a){return a?"<true/>":"<false/>"},dict:function(a){var b=Object.keys(a);return"<dict>"+(b.sort()&&b).reduce(function(b,c){var e=a[c];return b+"<key>"+c+"</key>"+
	d[typeof e](e)},"")+"</dict>"},number:function(a){return"<real>"+(a?a:"0.0")+"</real>"},object:function(a){return d[a instanceof Array?"array":"dict"](a)},string:function(a){return"<string>"+a+"</string>"}};b=d.dict(b);return Application("Keyboard Maestro Engine").doScript(b)||b}(g?{AllWindows:"1"===h,AlreadyActivatedActionType:{"leave it at the front":"Normal","switch to last application":"SwitchToLast","hide the application":"Hide","quit the application":"Quit"}[f],Application:{BundleIdentifier:g,
	Name:c,NewFile:e.path},MacroActionType:"ActivateApplication",ReopenWindows:"1"===k}:{MacroActionType:"Notification",SoundName:"Sosumi",Subtitle:"Application not found as spelled",Text:"Custom KM Action: Activate application by name",Title:'"'+c+'"'})})("$KMPARAM_Activate","$KMPARAM_All_windows","$KMPARAM_Reopen_initial_windows","$KMPARAM_If_already_at_the_front");
JXA_END